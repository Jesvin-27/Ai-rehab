{"ast":null,"code":"let prevState = 'standing';\nlet lastSpeakTime = 0;\nlet lastSpoken = '';\nexport function resetChairSquat() {\n  prevState = 'standing';\n  lastSpeakTime = 0;\n  lastSpoken = '';\n}\nexport function processChairSquat(landmarks) {\n  const now = Date.now();\n  const speakCooldown = 3000;\n  const leftHip = landmarks[23];\n  const leftKnee = landmarks[25];\n  const leftAnkle = landmarks[27];\n  const rightHip = landmarks[24];\n  const rightKnee = landmarks[26];\n  const rightAnkle = landmarks[28];\n  if (!leftHip || !leftKnee || !leftAnkle || !rightHip || !rightKnee || !rightAnkle) {\n    return throttledSpeak('Body not fully visible. Please align with camera');\n  }\n  const getAngle = (a, b, c) => {\n    const ab = {\n      x: a.x - b.x,\n      y: a.y - b.y\n    };\n    const cb = {\n      x: c.x - b.x,\n      y: c.y - b.y\n    };\n    const dot = ab.x * cb.x + ab.y * cb.y;\n    const magAB = Math.sqrt(ab.x ** 2 + ab.y ** 2);\n    const magCB = Math.sqrt(cb.x ** 2 + cb.y ** 2);\n    const cosine = dot / (magAB * magCB);\n    return Math.acos(Math.max(-1, Math.min(1, cosine))) * (180 / Math.PI);\n  };\n  const leftAngle = getAngle(leftHip, leftKnee, leftAnkle);\n  const rightAngle = getAngle(rightHip, rightKnee, rightAnkle);\n  const avgAngle = (leftAngle + rightAngle) / 2;\n  if (avgAngle < 105 && prevState === 'standing') {\n    prevState = 'squatting';\n    return throttledSpeak('Good squat position');\n  }\n  if (avgAngle > 155 && prevState === 'squatting') {\n    prevState = 'standing';\n    return {\n      speak: 'Squat complete',\n      rep: 1\n    };\n  }\n  if (avgAngle > 140 && now - lastSpeakTime > speakCooldown) {\n    return throttledSpeak('Try bending your knees more');\n  }\n  return null;\n}\nfunction throttledSpeak(message) {\n  const now = Date.now();\n  if (message !== lastSpoken || now - lastSpeakTime > 3000) {\n    lastSpoken = message;\n    lastSpeakTime = now;\n    return {\n      speak: message\n    };\n  }\n  return null;\n}","map":{"version":3,"names":["prevState","lastSpeakTime","lastSpoken","resetChairSquat","processChairSquat","landmarks","now","Date","speakCooldown","leftHip","leftKnee","leftAnkle","rightHip","rightKnee","rightAnkle","throttledSpeak","getAngle","a","b","c","ab","x","y","cb","dot","magAB","Math","sqrt","magCB","cosine","acos","max","min","PI","leftAngle","rightAngle","avgAngle","speak","rep","message"],"sources":["/Users/jesvinblazegmail.com/PycharmProjects/Ai-rehab/src/exercises/ChairSquats.js"],"sourcesContent":["let prevState = 'standing';\nlet lastSpeakTime = 0;\nlet lastSpoken = '';\n\nexport function resetChairSquat() {\n  prevState = 'standing';\n  lastSpeakTime = 0;\n  lastSpoken = '';\n}\n\nexport function processChairSquat(landmarks) {\n  const now = Date.now();\n  const speakCooldown = 3000;\n\n  const leftHip = landmarks[23];\n  const leftKnee = landmarks[25];\n  const leftAnkle = landmarks[27];\n  const rightHip = landmarks[24];\n  const rightKnee = landmarks[26];\n  const rightAnkle = landmarks[28];\n\n  if (!leftHip || !leftKnee || !leftAnkle || !rightHip || !rightKnee || !rightAnkle) {\n    return throttledSpeak('Body not fully visible. Please align with camera');\n  }\n\n  const getAngle = (a, b, c) => {\n    const ab = { x: a.x - b.x, y: a.y - b.y };\n    const cb = { x: c.x - b.x, y: c.y - b.y };\n    const dot = ab.x * cb.x + ab.y * cb.y;\n    const magAB = Math.sqrt(ab.x ** 2 + ab.y ** 2);\n    const magCB = Math.sqrt(cb.x ** 2 + cb.y ** 2);\n    const cosine = dot / (magAB * magCB);\n    return Math.acos(Math.max(-1, Math.min(1, cosine))) * (180 / Math.PI);\n  };\n\n  const leftAngle = getAngle(leftHip, leftKnee, leftAnkle);\n  const rightAngle = getAngle(rightHip, rightKnee, rightAnkle);\n  const avgAngle = (leftAngle + rightAngle) / 2;\n\n  if (avgAngle < 105 && prevState === 'standing') {\n    prevState = 'squatting';\n    return throttledSpeak('Good squat position');\n  }\n\n  if (avgAngle > 155 && prevState === 'squatting') {\n    prevState = 'standing';\n    return { speak: 'Squat complete', rep: 1 };\n  }\n\n  if (avgAngle > 140 && now - lastSpeakTime > speakCooldown) {\n    return throttledSpeak('Try bending your knees more');\n  }\n\n  return null;\n}\n\nfunction throttledSpeak(message) {\n  const now = Date.now();\n  if (message !== lastSpoken || now - lastSpeakTime > 3000) {\n    lastSpoken = message;\n    lastSpeakTime = now;\n    return { speak: message };\n  }\n  return null;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}