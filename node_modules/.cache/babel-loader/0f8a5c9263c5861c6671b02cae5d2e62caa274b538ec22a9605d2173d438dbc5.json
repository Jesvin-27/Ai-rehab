{"ast":null,"code":"var _jsxFileName = \"/Users/jesvinblazegmail.com/PycharmProjects/Ai-rehab/src/components/PoseDetector.js\",\n  _s = $RefreshSig$();\n// PoseDetector.js\nimport React, { useRef, useEffect } from 'react';\nimport * as tf from '@tensorflow/tfjs';\nimport * as posedetection from '@tensorflow-models/pose-detection';\nimport '@tensorflow/tfjs-backend-webgl';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PoseDetector = ({\n  isActive,\n  onRepDetected\n}) => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const detectorRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  const repState = useRef('up'); // To track squat motion\n  const repCountRef = useRef(0);\n  useEffect(() => {\n    const setupDetector = async () => {\n      await tf.setBackend('webgl');\n      const detector = await posedetection.createDetector(posedetection.SupportedModels.MoveNet, {\n        modelType: posedetection.movenet.modelType.SINGLEPOSE_LIGHTNING\n      });\n      detectorRef.current = detector;\n    };\n    setupDetector();\n  }, []);\n  useEffect(() => {\n    if (!isActive) {\n      cancelAnimationFrame(animationFrameRef.current);\n      return;\n    }\n    const startCamera = async () => {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: true\n      });\n      videoRef.current.srcObject = stream;\n      await videoRef.current.play();\n      detectPose();\n    };\n    const detectPose = async () => {\n      if (!detectorRef.current || !videoRef.current) return;\n      const poses = await detectorRef.current.estimatePoses(videoRef.current);\n      drawResults(poses);\n      checkSquatLogic(poses);\n      animationFrameRef.current = requestAnimationFrame(detectPose);\n    };\n    const drawResults = poses => {\n      const ctx = canvasRef.current.getContext('2d');\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      poses.forEach(pose => {\n        pose.keypoints.forEach(kp => {\n          if (kp.score > 0.4) {\n            ctx.beginPath();\n            ctx.arc(kp.x, kp.y, 5, 0, 2 * Math.PI);\n            ctx.fillStyle = 'lime';\n            ctx.fill();\n          }\n        });\n      });\n    };\n    const checkSquatLogic = poses => {\n      if (!poses.length) return;\n      const keypoints = poses[0].keypoints;\n      const leftHip = keypoints.find(k => k.name === 'left_hip');\n      const leftKnee = keypoints.find(k => k.name === 'left_knee');\n      if (leftHip && leftKnee && leftHip.score > 0.5 && leftKnee.score > 0.5) {\n        const verticalDiff = leftHip.y - leftKnee.y;\n        if (verticalDiff > 40 && repState.current === 'up') {\n          repState.current = 'down';\n        } else if (verticalDiff < 20 && repState.current === 'down') {\n          repState.current = 'up';\n          repCountRef.current += 1;\n          onRepDetected(repCountRef.current);\n        }\n      }\n    };\n    startCamera();\n    return () => {\n      var _videoRef$current, _videoRef$current$src;\n      cancelAnimationFrame(animationFrameRef.current);\n      const tracks = (_videoRef$current = videoRef.current) === null || _videoRef$current === void 0 ? void 0 : (_videoRef$current$src = _videoRef$current.srcObject) === null || _videoRef$current$src === void 0 ? void 0 : _videoRef$current$src.getTracks();\n      tracks === null || tracks === void 0 ? void 0 : tracks.forEach(track => track.stop());\n    };\n  }, [isActive, onRepDetected]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative\",\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      width: \"640\",\n      height: \"480\",\n      className: \"w-full rounded-md\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      width: \"640\",\n      height: \"480\",\n      className: \"absolute top-0 left-0\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, this);\n};\n_s(PoseDetector, \"+yyxCevQ7Kzq5Pvvu9RWNAK4FDs=\");\n_c = PoseDetector;\nexport default PoseDetector;\nvar _c;\n$RefreshReg$(_c, \"PoseDetector\");","map":{"version":3,"names":["React","useRef","useEffect","tf","posedetection","jsxDEV","_jsxDEV","PoseDetector","isActive","onRepDetected","_s","videoRef","canvasRef","detectorRef","animationFrameRef","repState","repCountRef","setupDetector","setBackend","detector","createDetector","SupportedModels","MoveNet","modelType","movenet","SINGLEPOSE_LIGHTNING","current","cancelAnimationFrame","startCamera","stream","navigator","mediaDevices","getUserMedia","video","srcObject","play","detectPose","poses","estimatePoses","drawResults","checkSquatLogic","requestAnimationFrame","ctx","getContext","clearRect","width","height","forEach","pose","keypoints","kp","score","beginPath","arc","x","y","Math","PI","fillStyle","fill","length","leftHip","find","k","name","leftKnee","verticalDiff","_videoRef$current","_videoRef$current$src","tracks","getTracks","track","stop","className","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/jesvinblazegmail.com/PycharmProjects/Ai-rehab/src/components/PoseDetector.js"],"sourcesContent":["// PoseDetector.js\nimport React, { useRef, useEffect } from 'react';\nimport * as tf from '@tensorflow/tfjs';\nimport * as posedetection from '@tensorflow-models/pose-detection';\nimport '@tensorflow/tfjs-backend-webgl';\n\nconst PoseDetector = ({ isActive, onRepDetected }) => {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const detectorRef = useRef(null);\n  const animationFrameRef = useRef(null);\n\n  const repState = useRef('up'); // To track squat motion\n  const repCountRef = useRef(0);\n\n  useEffect(() => {\n    const setupDetector = async () => {\n      await tf.setBackend('webgl');\n      const detector = await posedetection.createDetector(posedetection.SupportedModels.MoveNet, {\n        modelType: posedetection.movenet.modelType.SINGLEPOSE_LIGHTNING,\n      });\n      detectorRef.current = detector;\n    };\n    setupDetector();\n  }, []);\n\n  useEffect(() => {\n    if (!isActive) {\n      cancelAnimationFrame(animationFrameRef.current);\n      return;\n    }\n\n    const startCamera = async () => {\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n      videoRef.current.srcObject = stream;\n      await videoRef.current.play();\n      detectPose();\n    };\n\n    const detectPose = async () => {\n      if (!detectorRef.current || !videoRef.current) return;\n\n      const poses = await detectorRef.current.estimatePoses(videoRef.current);\n      drawResults(poses);\n      checkSquatLogic(poses);\n      animationFrameRef.current = requestAnimationFrame(detectPose);\n    };\n\n    const drawResults = (poses) => {\n      const ctx = canvasRef.current.getContext('2d');\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n\n      poses.forEach((pose) => {\n        pose.keypoints.forEach((kp) => {\n          if (kp.score > 0.4) {\n            ctx.beginPath();\n            ctx.arc(kp.x, kp.y, 5, 0, 2 * Math.PI);\n            ctx.fillStyle = 'lime';\n            ctx.fill();\n          }\n        });\n      });\n    };\n\n    const checkSquatLogic = (poses) => {\n      if (!poses.length) return;\n      const keypoints = poses[0].keypoints;\n      const leftHip = keypoints.find((k) => k.name === 'left_hip');\n      const leftKnee = keypoints.find((k) => k.name === 'left_knee');\n\n      if (leftHip && leftKnee && leftHip.score > 0.5 && leftKnee.score > 0.5) {\n        const verticalDiff = leftHip.y - leftKnee.y;\n\n        if (verticalDiff > 40 && repState.current === 'up') {\n          repState.current = 'down';\n        } else if (verticalDiff < 20 && repState.current === 'down') {\n          repState.current = 'up';\n          repCountRef.current += 1;\n          onRepDetected(repCountRef.current);\n        }\n      }\n    };\n\n    startCamera();\n\n    return () => {\n      cancelAnimationFrame(animationFrameRef.current);\n      const tracks = videoRef.current?.srcObject?.getTracks();\n      tracks?.forEach((track) => track.stop());\n    };\n  }, [isActive, onRepDetected]);\n\n  return (\n    <div className=\"relative\">\n      <video ref={videoRef} width=\"640\" height=\"480\" className=\"w-full rounded-md\" />\n      <canvas\n        ref={canvasRef}\n        width=\"640\"\n        height=\"480\"\n        className=\"absolute top-0 left-0\"\n      />\n    </div>\n  );\n};\n\nexport default PoseDetector;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}