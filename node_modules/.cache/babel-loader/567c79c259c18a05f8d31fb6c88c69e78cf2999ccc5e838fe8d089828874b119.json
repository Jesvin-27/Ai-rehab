{"ast":null,"code":"var _jsxFileName = \"/Users/jesvinblazegmail.com/PycharmProjects/Ai-rehab/src/components/PoseDetector.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect } from 'react';\nimport * as tf from '@tensorflow/tfjs';\nimport * as posedetection from '@tensorflow-models/pose-detection';\nimport '@tensorflow/tfjs-backend-webgl';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PoseDetector = ({\n  onRepetition,\n  onBadPosture\n}) => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const detectorRef = useRef(null);\n  const postureState = useRef('up'); // 'up' or 'down'\n\n  const speak = text => {\n    const utterance = new SpeechSynthesisUtterance(text);\n    speechSynthesis.cancel(); // Stop previous speech\n    speechSynthesis.speak(utterance);\n  };\n  useEffect(() => {\n    let animationFrameId;\n    const loadModel = async () => {\n      await tf.setBackend('webgl');\n      await tf.ready();\n      detectorRef.current = await posedetection.createDetector(posedetection.SupportedModels.MoveNet, {\n        modelType: posedetection.movenet.modelType.SINGLEPOSE_LIGHTNING\n      });\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: true\n      });\n      videoRef.current.srcObject = stream;\n      await videoRef.current.play();\n      const detect = async () => {\n        const poses = await detectorRef.current.estimatePoses(videoRef.current);\n        drawKeypoints(poses);\n        processPose(poses[0]); // Only first detected person\n        animationFrameId = requestAnimationFrame(detect);\n      };\n      detect();\n    };\n    const drawKeypoints = poses => {\n      const ctx = canvasRef.current.getContext('2d');\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      if (!poses || poses.length === 0) return;\n      poses.forEach(pose => {\n        pose.keypoints.forEach(keypoint => {\n          if (keypoint.score > 0.5) {\n            ctx.beginPath();\n            ctx.arc(keypoint.x, keypoint.y, 6, 0, 2 * Math.PI);\n            ctx.fillStyle = 'lime';\n            ctx.fill();\n          }\n        });\n      });\n    };\n    const processPose = pose => {\n      if (!pose || !pose.keypoints) return;\n      const leftHip = pose.keypoints.find(k => k.name === 'left_hip');\n      const leftKnee = pose.keypoints.find(k => k.name === 'left_knee');\n      if (!leftHip || !leftKnee || leftHip.score < 0.5 || leftKnee.score < 0.5) return;\n      const yDiff = leftHip.y - leftKnee.y;\n      if (yDiff < 30 && postureState.current === 'up') {\n        postureState.current = 'down';\n        speak('Good! Now stand up.');\n      }\n      if (yDiff > 60 && postureState.current === 'down') {\n        postureState.current = 'up';\n        onRepetition(); // Repetition counted\n      }\n\n      // Optional: Detect bad posture if hip not going down enough\n      if (yDiff > 10 && yDiff < 25 && postureState.current === 'up') {\n        onBadPosture();\n      }\n    };\n    loadModel();\n    return () => {\n      var _videoRef$current;\n      cancelAnimationFrame(animationFrameId);\n      if ((_videoRef$current = videoRef.current) !== null && _videoRef$current !== void 0 && _videoRef$current.srcObject) {\n        videoRef.current.srcObject.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, [onRepetition, onBadPosture]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative\",\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      className: \"w-full h-auto\",\n      width: \"640\",\n      height: \"480\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      className: \"absolute top-0 left-0\",\n      width: \"640\",\n      height: \"480\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n};\n_s(PoseDetector, \"TCZOXrhJLhrgQHyUc24ABqWq8Zw=\");\n_c = PoseDetector;\nexport default PoseDetector;\nvar _c;\n$RefreshReg$(_c, \"PoseDetector\");","map":{"version":3,"names":["React","useRef","useEffect","tf","posedetection","jsxDEV","_jsxDEV","PoseDetector","onRepetition","onBadPosture","_s","videoRef","canvasRef","detectorRef","postureState","speak","text","utterance","SpeechSynthesisUtterance","speechSynthesis","cancel","animationFrameId","loadModel","setBackend","ready","current","createDetector","SupportedModels","MoveNet","modelType","movenet","SINGLEPOSE_LIGHTNING","stream","navigator","mediaDevices","getUserMedia","video","srcObject","play","detect","poses","estimatePoses","drawKeypoints","processPose","requestAnimationFrame","ctx","getContext","clearRect","width","height","length","forEach","pose","keypoints","keypoint","score","beginPath","arc","x","y","Math","PI","fillStyle","fill","leftHip","find","k","name","leftKnee","yDiff","_videoRef$current","cancelAnimationFrame","getTracks","track","stop","className","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/jesvinblazegmail.com/PycharmProjects/Ai-rehab/src/components/PoseDetector.js"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport * as tf from '@tensorflow/tfjs';\nimport * as posedetection from '@tensorflow-models/pose-detection';\nimport '@tensorflow/tfjs-backend-webgl';\n\nconst PoseDetector = ({ onRepetition, onBadPosture }) => {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const detectorRef = useRef(null);\n  const postureState = useRef('up'); // 'up' or 'down'\n\n  const speak = (text) => {\n    const utterance = new SpeechSynthesisUtterance(text);\n    speechSynthesis.cancel(); // Stop previous speech\n    speechSynthesis.speak(utterance);\n  };\n\n  useEffect(() => {\n    let animationFrameId;\n\n    const loadModel = async () => {\n      await tf.setBackend('webgl');\n      await tf.ready();\n\n      detectorRef.current = await posedetection.createDetector(\n        posedetection.SupportedModels.MoveNet,\n        {\n          modelType: posedetection.movenet.modelType.SINGLEPOSE_LIGHTNING,\n        }\n      );\n\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n      videoRef.current.srcObject = stream;\n      await videoRef.current.play();\n\n      const detect = async () => {\n        const poses = await detectorRef.current.estimatePoses(videoRef.current);\n        drawKeypoints(poses);\n        processPose(poses[0]); // Only first detected person\n        animationFrameId = requestAnimationFrame(detect);\n      };\n\n      detect();\n    };\n\n    const drawKeypoints = (poses) => {\n      const ctx = canvasRef.current.getContext('2d');\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n\n      if (!poses || poses.length === 0) return;\n\n      poses.forEach((pose) => {\n        pose.keypoints.forEach((keypoint) => {\n          if (keypoint.score > 0.5) {\n            ctx.beginPath();\n            ctx.arc(keypoint.x, keypoint.y, 6, 0, 2 * Math.PI);\n            ctx.fillStyle = 'lime';\n            ctx.fill();\n          }\n        });\n      });\n    };\n\n    const processPose = (pose) => {\n      if (!pose || !pose.keypoints) return;\n\n      const leftHip = pose.keypoints.find((k) => k.name === 'left_hip');\n      const leftKnee = pose.keypoints.find((k) => k.name === 'left_knee');\n\n      if (!leftHip || !leftKnee || leftHip.score < 0.5 || leftKnee.score < 0.5) return;\n\n      const yDiff = leftHip.y - leftKnee.y;\n\n      if (yDiff < 30 && postureState.current === 'up') {\n        postureState.current = 'down';\n        speak('Good! Now stand up.');\n      }\n\n      if (yDiff > 60 && postureState.current === 'down') {\n        postureState.current = 'up';\n        onRepetition(); // Repetition counted\n      }\n\n      // Optional: Detect bad posture if hip not going down enough\n      if (yDiff > 10 && yDiff < 25 && postureState.current === 'up') {\n        onBadPosture();\n      }\n    };\n\n    loadModel();\n\n    return () => {\n      cancelAnimationFrame(animationFrameId);\n      if (videoRef.current?.srcObject) {\n        videoRef.current.srcObject.getTracks().forEach((track) => track.stop());\n      }\n    };\n  }, [onRepetition, onBadPosture]);\n\n  return (\n    <div className=\"relative\">\n      <video ref={videoRef} className=\"w-full h-auto\" width=\"640\" height=\"480\" />\n      <canvas\n        ref={canvasRef}\n        className=\"absolute top-0 left-0\"\n        width=\"640\"\n        height=\"480\"\n      />\n    </div>\n  );\n};\n\nexport default PoseDetector;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}